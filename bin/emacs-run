#!/bin/sh
#
# Run command on the emacs server

socket="server"
while getopts s:k:q opt; do
    case "$opt" in
        k) socket="$OPTARG" ;;
        s) service="$OPTARG" ;;
        q) quiet="1" ;;
    esac
done
shift $((OPTIND-1))

cmd="$1"
socket="$XDG_RUNTIME_DIR/emacs/$socket"


# if serivce is provided and not active, skip.
if [ "$service" ] && ! systemctl --user is-active -q "$service"; then
    echo "Service $service is not active. Skipping"
    exit 0
fi

# if socket does not exist
if [ ! -e "$socket" ]; then
    echo "Can't find socket $socket. Skipping"
    exit 0
fi

# run the command on the server
if [ "$quiet" ]; then
    exec /usr/bin/emacsclient -s "$socket" -e "$cmd" > /dev/null
else
    exec /usr/bin/emacsclient -s "$socket" -e "$cmd"
fi
